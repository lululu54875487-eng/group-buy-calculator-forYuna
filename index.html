<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Yuna åœ˜è³¼æ¹Šåœ˜è¨ˆç®—å™¨</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang TC", sans-serif;
  background: #f6f7f9;
  padding: 12px;
  margin: 0;
}

h2 { text-align: center; margin: 6px 0 12px; }

.section {
  background: #fff;
  padding: 14px;
  border-radius: 14px;
  margin-bottom: 14px;
}

.grid3 {
  display: grid;
  gap: 12px;
}
@media (min-width: 640px) {
  .grid3 { grid-template-columns: repeat(3, 1fr); }
}

.label {
  font-size: 12px;
  color: #6e6e73;
  margin-bottom: 4px;
}

input {
  width: 100%;
  height: 38px;
  padding: 6px 10px;
  font-size: 15px;
  border-radius: 10px;
  border: 1px solid #d1d1d6;
  background: #fafafa;
  box-sizing: border-box;
}

.header, .row {
  display: flex;
  gap: 8px;
  align-items: center;
  margin-bottom: 8px;
  font-size: 14px;
}

.header div { font-weight: 600; }

.no { width: 26px; text-align: center; }
.price-input {
  width: 90px;
  text-align: center;
  font-weight: 600;
}

button {
  padding: 8px 10px;
  font-size: 14px;
  border: none;
  border-radius: 10px;
  background: #4a6cf7;
  color: #fff;
}

button.delete {
  background: #e5e5ea;
  color: #333;
}

.highlight {
  font-size: 16px;
  font-weight: 600;
}
</style>
</head>

<body>

<h2>ğŸ“¦ Yuna åœ˜è³¼æ¹Šåœ˜è¨ˆç®—å™¨Ver1.0<br>ğŸ’© By ç’ç’ç’</h2>

<!-- æŠ˜æ•¸ -->
<div class="section">
  <b>å„ªæƒ æŠ˜æ•¸</b>
  <div class="grid3">
    <div>
      <div class="label">å„ªæƒ çµ„åˆé‡‘é¡</div>
      <input type="number" id="bundlePrice" oninput="calculate()" />
    </div>
    <div>
      <div class="label">æŠ˜æ‰£ç¢¼é‡‘é¡</div>
      <input type="number" id="coupon" oninput="calculate()" />
    </div>
    <div>
      <div class="label">ç¸½åŸåƒ¹é‡‘é¡</div>
      <input type="number" id="bundleOriginal" oninput="calculate()" />
    </div>
  </div>
  <div>æŠ˜æ•¸ï¼š<b id="discountRate">0</b></div>
</div>

<!-- åœ˜è³¼å“é … -->
<div class="section">
  <b>åœ˜è³¼å“é …</b>
  <div class="header">
    <div class="no">#</div>
    <div style="flex:1">å“é …åç¨±</div>
    <div style="flex:1">åŸåƒ¹</div>
    <div>åœ˜è³¼åƒ¹</div>
  </div>
  <div id="items"></div>
  <button onclick="addItem()">â• æ–°å¢å“é …</button>
</div>

<!-- è´ˆå“ -->
<div class="section">
  <b>è´ˆå“</b>
  <div class="header">
    <div class="no">#</div>
    <div style="flex:1">è´ˆå“åç¨±</div>
    <div style="flex:1">é‡‘é¡</div>
    <div>å¹³å‡æŠ˜å…¥</div>
  </div>
  <div id="gifts"></div>
  <button onclick="addGift()">â• æ–°å¢è´ˆå“</button>
</div>

<!-- ç¸½è¨ˆ -->
<div class="section">
  <div class="highlight">ä¸»è³¼å¯¦éš›çµå¸³é‡‘é¡ï¼š<span id="checkout">0</span></div>
  <div class="highlight">æ¹Šåœ˜ç¸½åƒ¹ï¼š<span id="groupTotal">0</span> <span id="checkMark"></span></div>
  <br>
  <button onclick="copyText()">ğŸ“‹ ä¸€éµè¤‡è£½èªè³¼æ¸…å–®</button>
</div>

<script>
function getRate() {
  return bundleOriginal.value > 0
    ? (bundlePrice.value - coupon.value) / bundleOriginal.value
    : 0;
}

function renumber() {
  let i = 1;
  document.querySelectorAll("#items .row").forEach(r => r.querySelector(".no").innerText = i++);
  document.querySelectorAll("#gifts .row").forEach(r => r.querySelector(".no").innerText = i++);
}

function addItem() {
  const r = document.createElement("div");
  r.className = "row";
  r.innerHTML = `
    <div class="no"></div>
    <input placeholder="å“é …åç¨±" />
    <input type="number" placeholder="åŸåƒ¹" oninput="calculate()" />
    <input type="number" class="price-input" value="0" min="0"
      oninput="this.dataset.locked='1'" />
    <button class="delete" onclick="this.parentElement.remove(); calculate()">âœ–</button>
  `;
  items.appendChild(r);
  renumber();
  calculate();
}

function addGift() {
  const r = document.createElement("div");
  r.className = "row";
  r.innerHTML = `
    <div class="no"></div>
    <input placeholder="è´ˆå“åç¨±" />
    <input type="number" placeholder="é‡‘é¡" oninput="calculate()" />
    <input type="checkbox" onchange="calculate(true)" />
    <button class="delete" onclick="this.parentElement.remove(); calculate(true)">âœ–</button>
  `;
  gifts.appendChild(r);
  renumber();
}

function calculate(forceRecalc = false) {
  const rate = getRate();
  discountRate.innerText = rate.toFixed(4);

  const itemRows = document.querySelectorAll("#items .row");
  const giftRows = document.querySelectorAll("#gifts .row");

  let giftSharedTotal = 0;
  giftRows.forEach(r => {
    const amount = Number(r.children[2].value);
    const shared = r.children[3].checked;
    if (shared) giftSharedTotal += amount;
  });

  const sharePerItem = itemRows.length
    ? Math.round(giftSharedTotal / itemRows.length)
    : 0;

  let groupSum = 0;

  itemRows.forEach(r => {
    const original = Number(r.children[2].value);
    const basePrice = Math.round(original * rate);
    const priceEl = r.querySelector(".price-input");

    if (forceRecalc || !priceEl.dataset.locked) {
      priceEl.value = basePrice + sharePerItem;
    }
    groupSum += Number(priceEl.value);
  });

  const checkoutVal = Number(bundlePrice.value) - Number(coupon.value);
  checkout.innerText = checkoutVal;
  // æ¹Šåœ˜ç¸½åƒ¹å›ºå®šä»¥åŸæœ¬è¨ˆç®—çµæœé¡¯ç¤ºï¼Œä¸å—å¹³å‡æŠ˜å…¥å½±éŸ¿
  if (!calculate.fixedGroupTotal) {
    calculate.fixedGroupTotal = groupSum;
  }
  groupTotal.innerText = calculate.fixedGroupTotal;
  checkMark.innerText = checkoutVal === calculate.fixedGroupTotal ? "âœ…" : "âŒ";

  renumber();
}

addItem();

function copyText() {
  let text = `ğŸ“¦ æ¹Šåœ˜èªè³¼æ¸…å–®

`;

  text += `å„ªæƒ çµ„åˆé‡‘é¡ğŸ’°${bundlePrice.value || 0}
`;
  text += `æŠ˜æ‰£ç¢¼ğŸ’°${coupon.value || 0}
`;
  text += `æŠ˜æ•¸ï¼š${discountRate.innerText}

`;

  let i = 1;

  document.querySelectorAll("#items .row").forEach(r => {
    const name = r.children[1].value || "ï¼ˆæœªå¡«å¯«ï¼‰";
    const price = r.querySelector(".price-input").value;
    text += `${i++}. ${name} $${price} â¡ï¸
`;
  });

  document.querySelectorAll("#gifts .row").forEach(r => {
    const name = r.children[1].value || "ï¼ˆæœªå¡«å¯«ï¼‰";
    const amount = r.children[2].value || 0;
    const shared = r.children[3].checked;
    text += `${i++}. è´ˆå“ï¼š${name} $${amount}${shared ? "ï¼ˆå¹³å‡æŠ˜å…¥ï¼‰" : ""} â¡ï¸
`;
  });

  text += `
ä¸»è³¼å¯¦éš›çµå¸³é‡‘é¡ğŸ’°${checkout.innerText}
`;
  text += `æ¹Šåœ˜ç¸½åƒ¹ğŸ’°${groupTotal.innerText}${checkout.innerText === groupTotal.innerText ? "âœ…" : ""}
`;
  text += `â­ï¸è«‹åœ¨ç®­é ­â¡ï¸å¾Œæ–¹æ‰“ä¸Šåå­—èªè³¼`;

  navigator.clipboard.writeText(text);
  alert("å·²è¤‡è£½ï¼Œå¯ç›´æ¥è²¼åˆ°ç¤¾ç¾¤ï¼");
}
</script>

</body>
</html>

