<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Yunaåœ˜è³¼æ¹Šåœ˜è¨ˆç®—å™¨</title>
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang TC", "Noto Sans TC", sans-serif;
    background: #f2f2f7;      /* iOS ç³»çµ±èƒŒæ™¯ */
    padding: 12px;
    margin: 0;
}
h2 {
    text-align: center;
    font-size: 18px;
    font-weight: 600;
    margin: 6px 0 14px;
}
h4 { text-align: center; }


.section {
    background: #ffffff;
    padding: 14px;
    border-radius: 14px;
    margin-bottom: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.04);
}

.grid3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
}

.label {
    font-size: 12px;
    color: #8e8e93;
    margin-bottom: 2px;
}

input {
    width: 100%;
    padding: 6px 10px;
    font-size: 15px;
    height: 36px;
    border-radius: 8px;
    border: 1px solid #d1d1d6;
    background: #ffffff;
    box-sizing: border-box;
}

.grid3 input {
    height: 34px;
    padding: 4px 6px;
    font-size: 14px;
}
.header, .row {
    display: flex;
    gap: 6px;
    margin-bottom: 6px;
    font-size: 14px;
}

.header div { font-weight: bold; }

.no { width: 26px; text-align: center; }
.price { width: 80px; text-align: center; font-weight: bold; }

.adjust {
    display: flex;
    gap: 4px;
    align-items: center;
}

.adjust button {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    font-size: 16px;
    padding: 0;
}
button {
    padding: 8px;
    font-size: 14px;
    border: none;
    border-radius: 6px;
    background: #4a6cf7;
    color: #fff;
}

button.delete {
    background: #e5e5ea;
    color: #3a3a3c;
}

.highlight {
    font-size: 17px;
    font-weight: 600;
    margin-bottom: 6px;
}

.ok { color: green; }
.ng { color: #d63333; }
</style>
</head>

<body>

<h2>ğŸ“¦ Yunaåœ˜è³¼æ¹Šåœ˜è¨ˆç®—å™¨ver1.0 </h2><h4>ğŸ’©Byç’ç’ç’ </h4>


<!-- æŠ˜æ•¸ -->
<div class="section">
<b>å„ªæƒ æŠ˜æ•¸</b>
<div class="grid3">
    <div>
        <div class="label">å„ªæƒ çµ„åˆé‡‘é¡</div>
        <input type="number" id="bundlePrice" oninput="calculate()">
    </div>
    <div>
        <div class="label">æŠ˜æ‰£ç¢¼é‡‘é¡</div>
        <input type="number" id="coupon" oninput="calculate()">
    </div>
    <div>
        <div class="label">ç¸½åŸåƒ¹é‡‘é¡</div>
        <input type="number" id="bundleOriginal" oninput="calculate()">
    </div>
</div>
<div>æŠ˜æ•¸ï¼š<b id="discountRate">0</b></div>
</div>

<!-- åœ˜è³¼å“é … -->
<div class="section">
<b>åœ˜è³¼å“é …</b>
<div class="header">
    <div class="no">#</div>
    <div style="flex:1">å“é …åç¨±</div>
    <div style="flex:1">åŸåƒ¹</div>
    <div class="price">åœ˜è³¼åƒ¹</div>
</div>
<div id="items"></div>
<button onclick="addItem()">â• æ–°å¢å“é …</button>
</div>

<!-- è´ˆå“ -->
<div class="section">
<b>è´ˆå“</b>
<div class="header">
    <div class="no">#</div>
    <div style="flex:1">è´ˆå“åç¨±</div>
    <div style="flex:1">é‡‘é¡</div>
</div>
<div id="gifts"></div>
<button onclick="addGift()">â• æ–°å¢è´ˆå“</button>
</div>

<!-- ç¸½è¨ˆ -->
<div class="section">
<div class="highlight">
ä¸»è³¼å¯¦éš›çµå¸³é‡‘é¡ï¼š<span id="checkout">0</span>
</div>
<div class="highlight">
æ¹Šåœ˜ç¸½åƒ¹ï¼š<span id="groupTotal">0</span>
<span id="checkMark"></span>
</div>

<button onclick="copyText()">ğŸ“‹ è¤‡è£½èªè³¼æ¸…å–®</button>
</div>

<script>
function getRate() {
    return bundleOriginal.value > 0
        ? (bundlePrice.value - coupon.value) / bundleOriginal.value
        : 0;
}

function renumber() {
    let i = 1;
    document.querySelectorAll("#items .row").forEach(r => r.querySelector(".no").innerText = i++);
    document.querySelectorAll("#gifts .row").forEach(r => r.querySelector(".no").innerText = i++);
}

function addItem() {
    const r = document.createElement("div");
    r.className = "row";
    r.innerHTML = `
        <div class="no"></div>
        <input placeholder="å“é …åç¨±">
        <input type="number" placeholder="åŸåƒ¹" oninput="calculate()">
        <div class="adjust">
            <button onclick="adjust(this,-1)">âˆ’</button>
            <div class="price">0</div>
            <button onclick="adjust(this,1)">ï¼‹</button>
        </div>
        <button class="delete" onclick="this.parentElement.remove(); calculate()">âœ–</button>
    `;
    items.appendChild(r);
    renumber();
}

function adjust(btn, delta) {
    const priceEl = btn.parentElement.querySelector(".price");
    let v = Number(priceEl.innerText) + delta;
    if (v < 0) v = 0;
    priceEl.innerText = v;
    calculate();
}

function addGift() {
    const r = document.createElement("div");
    r.className = "row";
    r.innerHTML = `
        <div class="no"></div>
        <input placeholder="è´ˆå“åç¨±">
        <input type="number" placeholder="é‡‘é¡" oninput="calculate()">
        <label style="font-size:12px;">
            <input type="checkbox" onchange="calculate()"> å¹³å‡æŠ˜å…¥
        </label>
        <button class="delete" onclick="this.parentElement.remove(); calculate()">âœ–</button>
    `;
    gifts.appendChild(r);
    renumber();
}

function calculate() {
    const rate = getRate();
    discountRate.innerText = rate.toFixed(4);

    const itemRows = document.querySelectorAll("#items .row");
    const giftRows = document.querySelectorAll("#gifts .row");

    let giftSharedTotal = 0;   // å‹¾é¸å¹³å‡æŠ˜å…¥ï¼ˆè² æ•¸ï¼‰
    let giftStandaloneTotal = 0;

    giftRows.forEach(r => {
        const amount = Number(r.querySelector("input[type='number']").value);
        const shared = r.querySelector("input[type='checkbox']").checked;
        if (shared) giftSharedTotal -= amount;
        else giftStandaloneTotal += amount;
    });

    const sharePerItem = itemRows.length > 0
        ? Math.round(giftSharedTotal / itemRows.length)
        : 0;

    let groupSum = 0;
    itemRows.forEach(r => {
        const original = Number(r.children[2].value);
        const basePrice = Math.round(original * rate);
        const priceEl = r.querySelector(".price");
        if (!priceEl.dataset.locked) {
            priceEl.innerText = basePrice + sharePerItem;
        }
        groupSum += Number(priceEl.innerText);
    });

    const checkoutVal = Number(bundlePrice.value) - Number(coupon.value);

    // â­ é—œéµä¿®æ”¹ï¼šåªåŠ ã€Œå‹¾é¸å¹³å‡æŠ˜å…¥ã€çš„è´ˆå“
    const sharedGiftAmount = Math.abs(giftSharedTotal);
    const displayGroupTotal = groupSum + sharedGiftAmount;

    checkout.innerText = checkoutVal;
    groupTotal.innerText = displayGroupTotal;
    checkMark.innerText = checkoutVal === displayGroupTotal ? "âœ…" : "âŒ";

    renumber();
}

function copyText() {
    let text =
`ğŸ“¦ æ¹Šåœ˜èªè³¼æ¸…å–®
å„ªæƒ çµ„åˆé‡‘é¡ğŸ’°${bundlePrice.value}
æŠ˜æ‰£ç¢¼ğŸ’°${coupon.value}
æŠ˜æ•¸ï¼š${discountRate.innerText}

`;

    let i = 1;

    // å“é …
    document.querySelectorAll("#items .row").forEach(r => {
        text += `${i++}. ${r.children[1].value} $${r.querySelector(".price").innerText} â¡ï¸\n`;
    });

    // è´ˆå“ï¼ˆå…¨éƒ¨åˆ—å‡ºï¼‰
    document.querySelectorAll("#gifts .row").forEach(r => {
        const name = r.children[1].value;
        const amount = r.children[2].value;
        const shared = r.querySelector("input[type='checkbox']").checked;

        //text += `${i++}. è´ˆå“ï¼š${name} $${amount}${shared ? "ï¼ˆå¹³å‡æŠ˜å…¥ï¼‰" : ""} â¡ï¸\n`;
      text += `${i++}. è´ˆå“ï¼š${name} $${amount}â¡ï¸\n`;

    });

    text += `
ä¸»è³¼å¯¦éš›çµå¸³é‡‘é¡ğŸ’°${checkout.innerText}
æ¹Šåœ˜ç¸½åƒ¹ğŸ’°${groupTotal.innerText}${checkout.innerText==groupTotal.innerText?"âœ…":""}
â­ï¸è«‹åœ¨ç®­é ­â¡ï¸å¾Œæ–¹æ‰“ä¸Šåå­—èªè³¼`;

    navigator.clipboard.writeText(text);
    alert("å·²è¤‡è£½ï¼Œå¯ç›´æ¥è²¼åˆ°ç¤¾ç¾¤ï¼");
}

addItem();
</script>

</body>
</html>








