<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Yunaåœ˜è³¼æ¹Šåœ˜è¨ˆç®—å™¨</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang TC", "Noto Sans TC", sans-serif;
    background: #f2f2f7;
    padding: 12px;
    margin: 0;
}
h2,h4{text-align:center;margin:6px 0}

.section{
    background:#fff;
    padding:14px;
    border-radius:14px;
    margin-bottom:14px;
}

/* èª¿æ•´ä¸Šæ–¹ä¸‰æ¬„å¯¬åº¦ï¼Œé¿å…é‚Šæ¡†é‡ç–Š */
.grid3{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:12px; /* åŸæœ¬ 8px â†’ åŠ å¤§ */
}

.label{font-size:12px;color:#8e8e93}
input{
    width:100%;
    height:32px; /* ç¨å¾®ç¸®å°é«˜åº¦ */
    font-size:14px;
    padding:4px 8px;
    border-radius:8px;
    border:1px solid #d1d1d6;
    box-sizing:border-box; /* é—œéµï¼šé¿å…å¯¬åº¦è¨ˆç®—éŒ¯èª¤ */
}

.header,.row{
    display:flex;
    gap:6px;
    align-items:center;
    margin-bottom:6px;
    font-size:13px;
}

.no{width:22px;text-align:center}
.price{width:50px;text-align:center;font-weight:600}

.adjust{
    display:flex;
    align-items:center;
    gap:2px;
}

.adjust button{
    width:26px;
    height:26px;
    border-radius:50%;
    font-size:14px;
    padding:0;
}

button{
    padding:6px 8px;
    font-size:13px;
    border:none;
    border-radius:6px;
    background:#4a6cf7;
    color:#fff;
    touch-action:manipulation;
}

button.delete{background:#e5e5ea;color:#333}
button.unlock{background:#34c759}

.highlight{font-size:16px;font-weight:600}
</style>
</head>

<body>

<h2>ğŸ“¦ Yunaåœ˜è³¼æ¹Šåœ˜è¨ˆç®—å™¨</h2>
<h4>ğŸ’© By ç’ç’ç’</h4>

<div class="section">
<b>å„ªæƒ æŠ˜æ•¸</b>
<div class="grid3">
<input id="bundlePrice" type="number" placeholder="å„ªæƒ çµ„åˆé‡‘é¡">
<input id="coupon" type="number" placeholder="æŠ˜æ‰£ç¢¼">
<input id="bundleOriginal" type="number" placeholder="ç¸½åŸåƒ¹">
</div>
<div>æŠ˜æ•¸ï¼š<b id="discountRate">0</b></div>
</div>

<div class="section">
<b>åœ˜è³¼å“é …</b>
<div class="header">
<div class="no">#</div>
<div style="flex:1">åç¨±</div>
<div style="flex:1">åŸåƒ¹</div>
<div class="price">åœ˜è³¼</div>
</div>
<div id="items"></div>
<button onclick="addItem()">â• æ–°å¢å“é …</button>
</div>

<div class="section">
<b>ç¸½è¨ˆ</b>
<div class="highlight">ä¸»è³¼å¯¦ä»˜ï¼š<span id="checkout">0</span></div>
<div class="highlight">æ¹Šåœ˜ç¸½åƒ¹ï¼š<span id="groupTotal">0</span> <span id="checkMark"></span></div>
</div>

<script>
let holdTimer;

function getRate(){
    return bundleOriginal.value>0
        ? (bundlePrice.value - coupon.value) / bundleOriginal.value
        : 0;
}

function addItem(data={}){
    const r=document.createElement("div");
    r.className="row";
    r.innerHTML=`
    <div class="no"></div>
    <input value="${data.name||""}" placeholder="å“é …">
    <input type="number" value="${data.original||""}">
    <div class="adjust">
        <button onmousedown="hold(this,-1)" onmouseup="clearHold()" ontouchstart="hold(this,-1)" ontouchend="clearHold()">âˆ’</button>
        <div class="price">${data.price||0}</div>
        <button onmousedown="hold(this,1)" onmouseup="clearHold()" ontouchstart="hold(this,1)" ontouchend="clearHold()">ï¼‹</button>
    </div>
    <button class="unlock" onclick="unlock(this)">ğŸ”“</button>
    <button class="delete" onclick="this.parentElement.remove();save();calculate()">âœ–</button>
    `;
    items.appendChild(r);
    calculate();
}

function hold(btn,delta){
    adjust(btn,delta);
    holdTimer=setInterval(()=>adjust(btn,delta),150);
}

function clearHold(){clearInterval(holdTimer)}

function adjust(btn,delta){
    const priceEl=btn.parentElement.querySelector(".price");
    let v=Number(priceEl.innerText)+delta;
    if(v<0)v=0;
    priceEl.innerText=v;
    priceEl.dataset.locked="1";
    calculate();
}

function unlock(btn){
    const priceEl=btn.parentElement.querySelector(".price");
    delete priceEl.dataset.locked;
    calculate();
}

function calculate(){
    const rate=getRate();
    discountRate.innerText=rate.toFixed(4);

    let sum=0;
    document.querySelectorAll("#items .row").forEach((r,i)=>{
        r.querySelector(".no").innerText=i+1;
        const original=Number(r.children[2].value);
        const auto=Math.round(original*rate);
        const priceEl=r.querySelector(".price");
        if(!priceEl.dataset.locked) priceEl.innerText=auto;
        sum+=Number(priceEl.innerText);
    });

    checkout.innerText=bundlePrice.value-coupon.value;
    groupTotal.innerText=sum;
    checkMark.innerText=checkout.innerText==sum?"âœ…":"âŒ";
    save();
}

function save(){
    const data={
        bundlePrice:bundlePrice.value,
        coupon:coupon.value,
        bundleOriginal:bundleOriginal.value,
        items:[...document.querySelectorAll("#items .row")].map(r=>({
            name:r.children[1].value,
            original:r.children[2].value,
            price:r.querySelector(".price").innerText
        }))
    };
    localStorage.setItem("groupCalc",JSON.stringify(data));
}

function load(){
    const d=JSON.parse(localStorage.getItem("groupCalc")||"null");
    if(!d)return;
    bundlePrice.value=d.bundlePrice;
    coupon.value=d.coupon;
    bundleOriginal.value=d.bundleOriginal;
    d.items.forEach(addItem);
}

load();
addItem();
</script>

</body>
</html>
