<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Yuna åœ˜è³¼æ¹Šåœ˜è¨ˆç®—å™¨</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang TC", sans-serif;
  background: #f6f7f9;
  padding: 12px;
  margin: 0;
}

h2 { text-align: center; margin: 6px 0 12px; }
.hint {
  font-size: 11px;
  color: #8e8e93;
  margin-top: 4px;
  line-height: 1.4;
}
.hint-blue {
  color: #0a84ff;
  background: rgba(10,132,255,0.1);
  padding: 2px 6px;
  border-radius: 6px;
  text-align: center;
}
.section {
  background: #fff;
  padding: 14px;
  border-radius: 14px;
  margin-bottom: 14px;
}
.watermark {
  position: fixed;
  bottom: 8px;
  right: 8px;
  font-size: 11px;
  color: rgba(0,0,0,0.2);
  pointer-events: none; /* ä¸å½±éŸ¿é»æ“Š */
}
.grid3 {
  display: grid;
  gap: 12px;
}
@media (min-width: 640px) {
  .grid3 { grid-template-columns: repeat(3, 1fr); }
}

.label {
  font-size: 12px;
  color: #6e6e73;
  margin-bottom: 4px;
}

input {
  width: 100%;
  height: 38px;
  padding: 6px 10px;
  font-size: 15px;
  border-radius: 10px;
  border: 1px solid #d1d1d6;
  background: #fafafa;
  box-sizing: border-box;
}
/* ===== æ¡Œæ©Ÿç‰ˆæ¬„ä½å°é½Š ===== */
.header .col {
  flex: 1;
}

.header .price-col {
  width: 90px;          /* è·Ÿ .price-input ä¸€æ¨£ */
  text-align: center;
}
.item-row {
  position: relative;
}

.delete-btn {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
}
.header .price-col .label {
  margin-bottom: 0;
  font-size: 12px;
  color: #6e6e73;
}

.header, .row {
  display: flex;
  gap: 8px;
  align-items: center;
  margin-bottom: 8px;
  font-size: 14px;
}
.price-input.manual {
  background: #fff3cd;   /* æ·¡é»ƒ */
  border-color: #f5c06f;
}

.header div { font-weight: 600; }
.warning-box {
  color: #b30000;
  background-color: #fff3f3;
  border: 1px solid #ffb3b3;
  padding: 8px 12px;
  border-radius: 4px;
  line-height: 1.6;
}
.no { width: 26px; text-align: center; }
.price-input {
  width: 90px;
  text-align: center;
  font-weight: 600;
}
button.copy { 
  background: #e5e5ea; 
  color: #333; 
  padding: 6px 8px; 
  border-radius: 8px; 
  font-size: 14px; 
}
button {
  padding: 8px 10px;
  font-size: 14px;
  border: none;
  border-radius: 10px;
  background: #6b8cff;
  color: #fff;
}
button:active {
  transform: scale(0.97);
  opacity: 0.9;
}
button.delete {
  background: #e5e5ea;
  color: #333;
}

.highlight {
  font-size: 16px;
  font-weight: 600;
}

  /* ===== æ‰‹æ©Ÿç‰ˆæ¬„ä½ä¿®æ­£ ===== */
@media (max-width: 480px) {
  /* éš±è—è´ˆå“ header çš„ã€Œå¹³å‡æŠ˜å…¥ã€ */
  #gifts .header div:nth-child(4) {
    display: none;
  }
/* checkbox å®¹å™¨å®šä½ */
  #gifts .row input[type="checkbox"] {
    position: relative;
    margin-top: 14px;
  }
  button.copy {
    padding: 1px 3px;
    font-size: 11px;
  }
   /* checkbox ä¸Šæ–¹çš„æ–‡å­— */
  #gifts .row input[type="checkbox"]::before {
    position: absolute;
    top: -14px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 11px;
    color: #6e6e73;
    white-space: nowrap;
  }
  /* ç¬¬ä¸€è¡Œ */
  #gifts .header div:nth-child(1) { grid-row: 1; } /* # */
  #gifts .header div:nth-child(2) { grid-row: 1; } /* è´ˆå“åç¨± */

  /* ç¬¬äºŒè¡Œ */
  #gifts .header div:nth-child(3) {
    grid-row: 2;
    grid-column: 2;
    font-size: 12px;
    color: #6e6e73;
  }
   #additionalItems .header,
  #additionalItems .row {
    /* #, åç¨±, é‡‘é¡, åˆªé™¤æŒ‰éˆ• */
    grid-template-columns: 26px 1fr 70px auto; 
    gap: 6px;
    align-items: center;
  }
  #gifts .header div:nth-child(4) {
    grid-row: 2;
    grid-column: 2;
    justify-self: end;
    font-size: 12px;
    color: #6e6e73;
  }
  .header,
  .row {
    display: grid;
    grid-template-columns: 26px 1fr 70px 64px auto;
    gap: 6px;
    align-items: center;
  }

  /* è´ˆå“æ¬„ä½ï¼ˆæ²’æœ‰åœ˜è³¼åƒ¹ï¼Œå¤šä¸€å€‹ checkboxï¼‰ */
  #gifts .header,
  #gifts .row {
    grid-template-columns: 26px 1fr 70px 64px auto;
  }

  .price-input {
    width: 64px;
    padding: 4px;
    box-sizing: border-box;
  }

  input[type="checkbox"] {
    transform: scale(1.0);
  }

  input[readonly] {
  background: #f1f1f3;
  color: #555;
}

  button.delete {
    padding: 6px;
  }
}
</style>
</head>
<div class="watermark">
  é™ Yunaæ‚ é‚£è€å¤§ åœ˜è³¼ä½¿ç”¨ï½œç¦æ­¢å¤–æµï½œcreat byç’ç’ç’
</div>
<body>

<h2>ğŸ‡Yuna åœ˜è³¼æ¹Šåœ˜è¨ˆç®—å™¨Ver1.1<br>ğŸ’© By ç’ç’ç’</h2>

<!-- æŠ˜æ•¸ -->
<div class="section">
  <b>â‡ï¸å„ªæƒ æŠ˜æ•¸</b>
  <div class="grid3">
    <div>
      <div class="label">åœ˜è³¼å“é …å„ªæƒ ç¸½é‡‘é¡(A)</div>
      <input type="number" id="bundlePrice" oninput="calculate()" />
      <div class="hint">æƒ³è²·çš„é€šé€šåŠ é€²è³¼ç‰©è»Šå¾Œçš„é‡‘é¡</div>
    </div>
    <div>
      <div class="label">æŠ˜æ‰£ç¢¼é‡‘é¡(B)</div>
      <input type="number" id="coupon" oninput="calculate()" />
      <div class="hint">æŠ˜åƒ¹å·æˆ–è³¼ç‰©é‡‘éƒ½keyé€™è£¡</div>
    </div>
    <div>
      <div class="label">åœ˜è³¼å“é …åŸåƒ¹ç¸½é‡‘é¡(C)</div>
      <input type="number" id="bundleOriginal" readonly />
      <div class="hint hint-blue">æ­¤æ¬„ä½æœƒè‡ªå‹•è¨ˆç®—ï¼Œè«‹å…ˆè‡³ä¸‹æ–¹è¼¸å…¥å„å“é …åŸåƒ¹</div>
    </div>
  </div>
  
</div>

<!-- åœ˜è³¼å“é … -->
<div class="section">
  <b>â­ï¸åœ˜è³¼å“é …(åƒèˆ‡æŠ˜æ•¸è¨ˆç®—)</b> 
  <button onclick="recalcAll()">ğŸ’° åœ˜è³¼åƒ¹è¨ˆç®—</button>
  <div class="hint hint-blue">
  ğŸŒŸ è¼¸å…¥å®Œå„å“é …è«‹æŒ‰ä¸€ä¸‹ã€ŒğŸ’° åœ˜è³¼åƒ¹è¨ˆç®—ã€æŒ‰éˆ• 
  </div>
<div class="header">
  <div class="no">#</div>
  <div style="flex:1">å“é …åç¨±</div>
  <div style="flex:1">åŸåƒ¹</div>
  <div style="flex:1;text-align:aoto;">åœ˜è³¼åƒ¹</div>
</div>
  <div id="items"></div>
  <button onclick="addItem()">â• æ–°å¢å“é …</button>
</div>
  
<!-- åŠ è³¼å“å“é … -->
<div class="section">
  <b>ğŸ’åŠ è³¼å“ (ä¸è¨ˆå…¥å„ªæƒ æŠ˜æ•¸ï¼ŒåŸåƒ¹è¨ˆå…¥ä¸»è³¼çµå¸³é‡‘é¡)</b>
<div class="header">
  <div class="no">#</div>
  <div style="flex:1">å“é …åç¨±</div>
  <div style="flex:1;text-align:right;">é‡‘é¡</div>
</div>
  <div id="additionalItems"></div>
  <button onclick="addAdditionalItem()">â• æ–°å¢åŠ è³¼å“</button>
</div>
  
<!-- è´ˆå“ -->
<div class="section">
  <b>ğŸè´ˆå“</b>
  <div class="header">
    <div class="no">#</div>
    <div style="flex:1">è´ˆå“åç¨±</div>
    <div style="flex:1">é‡‘é¡</div>
    <div style="flex:1;text-align:right;">å¹³å‡æŠ˜å…¥</div>
  </div>
  <div id="gifts"></div>
  <button onclick="addGift()">â• æ–°å¢è´ˆå“</button>
</div>
<!-- å¯„é€è³‡è¨Š -->
<div class="section">
  <b>ğŸ“¦ å¯„é€è³‡è¨Š</b>

  <div class="grid3">
    <div>
      <div class="label">å¯„é€æ–¹å¼</div>
      <input
        type="text"
        id="shippingMethod"
        placeholder="ä¾‹å¦‚ï¼šè³£è²¨ä¾¿ / iopen mall / é¢äº¤ "
      />
    </div>

    <div>
      <div class="label">é‹è²»</div>
      <input
        type="number"
        id="shippingFee"
        placeholder="0"
        min="0"
        oninput="calculate()"
      />
       <div class="hint hint-blue">å…é‹è«‹è¼¸å…¥ã€Œ0ã€</div>
    </div>
  </div>
</div>

<!-- ç¸½è¨ˆ -->
<div class="section">
  <div>æŠ˜æ•¸ï¼š(A-B)/C =<b id="discountRate">0</b></div>
  <div class="highlight">ä¸»è³¼å¯¦éš›çµå¸³é‡‘é¡ï¼š<span id="checkout">0</span></div>
  <div class="highlight">æ¹Šåœ˜ç¸½åƒ¹ï¼š<span id="groupTotal">0</span> <span id="checkMark"></span></div>
  <br>
  
  
 <div id="roundingHint" class="hint warning-box" style="display:none;">
  <strong>âš  æ³¨æ„ï¼š</strong><br>
  å¦‚æœé¡¯ç¤ºã€ŒâŒã€ï¼Œè¡¨ç¤ºæŸäº›å“é …åŸåƒ¹è¨ˆç®—æŠ˜æ•¸å› å››æ¨äº”å…¥é€ æˆèª¤å·®ï¼Œ<br>
  è«‹æ‰‹å‹•èª¿æ•´æŸäº›å“é …åœ˜è³¼åƒ¹ï¼Œè®“åœ–ç¤ºé¡¯ç¤ºã€Œâœ…ã€å°±å¯ä»¥è¤‡è£½äº†<br>
ï¼ˆæœ‰æ‰‹å‹•èª¿æ•´çš„åœ˜è³¼åƒ¹æ¬„ä½æœƒé¡¯ç¤ºé»ƒåº•ï¼‰
</div><br>
  <button onclick="copyText()">ğŸ“‹ ä¸€éµè¤‡è£½èªè³¼æ¸…å–®</button>
</div>

<script>

let groupSumWithoutGifts = 0;
function getRate() {
  return bundleOriginal.value > 0
    ? (bundlePrice.value - coupon.value) / bundleOriginal.value
    : 0;
}

function renumber() {
  let i = 1;
  document.querySelectorAll("#items .row").forEach(r => r.querySelector(".no").innerText = i++);
  // æ–°å¢ï¼šé‡æ–°ç·¨è™ŸåŠ è³¼å“
  document.querySelectorAll("#additionalItems .row").forEach(r => r.querySelector(".no").innerText = i++);
  document.querySelectorAll("#gifts .row").forEach(r => r.querySelector(".no").innerText = i++);
}
function copyRow(btn) {
  const src = btn.parentElement;

  const name = src.children[1].value;
  const original = src.children[2].value;
  const price = src.querySelector(".price-input").value;

  const r = document.createElement("div");
  r.className = "row";
  r.innerHTML = `
    <div class="no"></div>
    <input value="${name}" />
    <input type="number" value="${original}" oninput="calculate()" />
    <input type="number" class="price-input manual" value="${price}"
      data-locked="1"
      oninput="this.dataset.locked='1'; this.classList.add('manual'); calculate()" />
    <button class="copy" onclick="copyRow(this); calculate()">ğŸ“‹</button>
    <button class="delete" onclick="this.parentElement.remove(); calculate()">âœ–</button>
  `;

  // ğŸ‘‡ æ’åœ¨æœ€ä¸‹æ–¹
  items.appendChild(r);

  renumber();
  calculate();
}
function addItem() {
  const r = document.createElement("div");
  r.className = "row";
  r.innerHTML = `
    <div class="no"></div>
    <input placeholder="å“é …åç¨±" />
    <input type="number" placeholder="åŸåƒ¹" oninput="calculate()" />
    <input type="number" class="price-input" value="0" min="0"
  oninput="
    this.dataset.locked='1';
    this.classList.add('manual');
    calculate();
  " />
    <button class="copy" onclick="copyRow(this)">ğŸ“‹</button>
    <button class="delete" onclick="this.parentElement.remove(); calculate()">âœ–</button>
  `;
  items.appendChild(r);
  renumber();
  calculate();
}
function recalcAll() {
  document.querySelectorAll("#items .price-input").forEach(input => {
    delete input.dataset.locked;   // è§£é™¤æ‰‹å‹•é–å®š
    input.classList.remove("manual");
  });
  calculate(true); // forceRecalc = true
}

function addGift() {
  const r = document.createElement("div");
  r.className = "row";
  r.innerHTML = `
    <div class="no"></div>
    <input placeholder="è´ˆå“åç¨±" />
    <input type="number" placeholder="é‡‘é¡" oninput="calculate()" />
    <input type="checkbox" onchange="calculate(true)" />
    <button class="delete" onclick="this.parentElement.remove(); calculate(true)">âœ–</button>
  `;
  gifts.appendChild(r);
  renumber();
}
// æ–°å¢åŠ è³¼å“é …ç›®
function addAdditionalItem() {
  const r = document.createElement("div");
  r.className = "row";
  r.innerHTML = `
    <div class="no"></div>
    <input placeholder="åŠ è³¼å“åç¨±" />
    <input type="number" class="price-input" placeholder="é‡‘é¡" value="0" min="0" oninput="calculate()" />
    <button class="delete" onclick="this.parentElement.remove(); calculate()">âœ–</button>
  `;
  // æ³¨æ„ï¼šé€™é‚Šçš„åŠ è³¼å“åªæœ‰ä¸‰å€‹æ¬„ä½ï¼Œæ‰€ä»¥ CSS æœƒéœ€è¦å¾®èª¿
  document.getElementById("additionalItems").appendChild(r);
  renumber();
  calculate();
}
function calculate(forceRecalc = false) {

  // â­ è‡ªå‹•ç®— C
  let originalSum = 0;
  document.querySelectorAll("#items .row").forEach(r => {
    originalSum += Number(r.children[2].value) || 0;
  });
  bundleOriginal.value = originalSum;
  
  const rate = getRate();
  discountRate.innerText = rate.toFixed(4);

  const itemRows = document.querySelectorAll("#items .row");
  // æ–°å¢ï¼šå–å¾—åŠ è³¼å“é …ç›®
  const additionalItemRows = document.querySelectorAll("#additionalItems .row");
  const giftRows = document.querySelectorAll("#gifts .row");

  let giftSharedTotal = 0;
  giftRows.forEach(r => {
    const amount = Number(r.children[2].value);
    const shared = r.children[3].checked;
    if (shared) giftSharedTotal -= amount;
  });

  const sharePerItem = itemRows.length
    ? Math.round(giftSharedTotal / itemRows.length)
    : 0;

  let groupSum = 0;

  itemRows.forEach(r => {
    const original = Number(r.children[2].value);
    const basePrice = Math.round(original * rate);
    const priceEl = r.querySelector(".price-input");

    if (forceRecalc || !priceEl.dataset.locked) {
      priceEl.value = basePrice + sharePerItem;
    }
    groupSum += Number(priceEl.value);
  });

 // æ–°å¢ï¼šè¨ˆç®—åŠ è³¼å“ç¸½é¡
  let additionalItemTotal = 0;
  additionalItemRows.forEach(r => {
    additionalItemTotal += Number(r.children[2].value) || 0;
  });

  groupSumWithoutGifts = groupSum - giftSharedTotal;

  // â­ é—œéµä¿®æ”¹ï¼šä¸»è³¼çµå¸³é‡‘é¡ = (çµ„åˆåƒ¹ - æŠ˜æ‰£ç¢¼) + åŠ è³¼å“ç¸½é¡
  const checkoutVal = (Number(bundlePrice.value) - Number(coupon.value)) + additionalItemTotal; 
  
  // â­ é—œéµä¿®æ”¹ï¼šæ¹Šåœ˜ç¸½åƒ¹ç¾åœ¨æ‡‰è©²è¦è·Ÿ checkoutVal æ¯”è¼ƒ
  const sharedGiftAmount = Math.abs(giftSharedTotal);
  const displayGroupTotal = groupSum + sharedGiftAmount + additionalItemTotal;

  checkout.innerText = checkoutVal;
  groupTotal.innerText = displayGroupTotal ;
  // â­ é—œéµä¿®æ”¹ï¼šæª¢æŸ¥æ¨™è¨˜æ‡‰æ¯”è¼ƒ checkoutVal èˆ‡ displayGroupTotal
  checkMark.innerText = checkoutVal === displayGroupTotal ? "âœ…" : "âŒ";
  roundingHint.style.display = checkMark.innerText === "âŒ" ? "block" : "none";
  renumber();
}

addItem();

function copyText() {
Â 
Â  calculate(); // â­â­â­ é€™ä¸€è¡Œä¸€å®šè¦æœ‰
Â  console.log("groupSumWithoutGifts =", groupSumWithoutGifts);
Â  let text = `ğŸ“¦ æ¹Šåœ˜èªè³¼æ¸…å–®

`;
// 4. å¯„é€è³‡è¨Š
const shippingMethodEl = document.getElementById("shippingMethod");
const shippingFeeEl = document.getElementById("shippingFee");

const shippingMethod = shippingMethodEl?.value?.trim() || "";
const shippingFee = Number(shippingFeeEl?.value) || 0;

if (shippingMethod || shippingFeeEl?.value !== "") {
  const shippingText = shippingFee === 0 ? "å…é‹ ğŸšš" : `$${shippingFee}`;

  text += `
å¯„é€æ–¹å¼ğŸ“¦ ${shippingMethod || "æœªå¡«å¯«"}
é‹è²»ğŸ’° ${shippingText}

`;
}
Â  text += `å„ªæƒ çµ„åˆé‡‘é¡ğŸ’°${bundlePrice.value || 0}
`;
Â  text += `æŠ˜æ‰£ç¢¼ğŸ’°${coupon.value || 0}
`;
Â  text += `æŠ˜æ•¸ï¼š${discountRate.innerText}

`;

Â  let i = 1;

Â  // 1. åœ˜è³¼å“é …
Â  document.querySelectorAll("#items .row").forEach(r => {
Â  Â  const name = r.children[1].value || "ï¼ˆæœªå¡«å¯«ï¼‰";
Â  Â  const price = r.querySelector(".price-input").value;
Â  Â  text += `${i++}. ${name} $${price} â¡ï¸
`;
Â  });
Â  
Â  // 2. ã€æ–°å¢ã€‘åŠ è³¼å“é …ç›®
Â  document.querySelectorAll("#additionalItems .row").forEach(r => {
Â  Â  const name = r.children[1].value || "ï¼ˆæœªå¡«å¯«ï¼‰";
Â  Â  // é€™è£¡ä½¿ç”¨ r.children[2] å–å¾—åƒ¹æ ¼æ¬„ä½çš„å€¼
Â  Â  const price = r.children[2].value || 0; 
Â  Â  text += `${i++}. ã€åŠ è³¼ã€‘${name} $${price} â¡ï¸
`;
Â  });

Â  // 3. è´ˆå“é …ç›®
Â  document.querySelectorAll("#gifts .row").forEach(r => {
Â  Â  const name = r.children[1].value || "ï¼ˆæœªå¡«å¯«ï¼‰";
Â  Â  const amount = r.children[2].value || 0;
Â  Â  const shared = r.children[3].checked;
Â  Â  text += `${i++}. è´ˆå“ï¼š${name} $${amount}${shared ? "ï¼ˆå¹³å‡æŠ˜å…¥ï¼‰" : ""} â¡ï¸
`;
Â  });

Â  text += `
ä¸»è³¼å¯¦éš›çµå¸³é‡‘é¡ğŸ’°${checkout.innerText}
`;
Â  // æ³¨æ„ï¼šæ­¤è™•éœ€ä½¿ç”¨é¡¯ç¤ºçš„æ¹Šåœ˜ç¸½åƒ¹ groupTotal.innerText ä¾†åšæœ€çµ‚æª¢æŸ¥æ¯”å°ï¼Œè€Œä¸æ˜¯ groupSumWithoutGifts
Â  text += `æ¹Šåœ˜ç¸½åƒ¹ğŸ’°${groupTotal.innerText}${document.getElementById('checkMark').innerText === 'âœ…' ? "âœ…" : "âŒ"}
`;
Â  text += `â­ï¸è«‹åœ¨ç®­é ­â¡ï¸å¾Œæ–¹æ‰“ä¸Šåå­—èªè³¼`;

Â  navigator.clipboard.writeText(text);
Â  alert("å·²è¤‡è£½ï¼Œå¯ç›´æ¥è²¼åˆ°ç¤¾ç¾¤ï¼");
}



</script>

</body>
</html>



















































