<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Yuna åœ˜è³¼æ¹Šåœ˜è¨ˆç®—å™¨</title>

<style>
body {
Â  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang TC", sans-serif;
Â  background: #f6f7f9;
Â  padding: 12px;
Â  margin: 0;
}

h2 { text-align: center; margin: 6px 0 12px; }

.section {
Â  background: #fff;
Â  padding: 14px;
Â  border-radius: 14px;
Â  margin-bottom: 14px;
}

.grid3 {
Â  display: grid;
Â  gap: 12px;
}
@media (min-width: 640px) {
Â  .grid3 { grid-template-columns: repeat(3, 1fr); }
}

.label {
Â  font-size: 12px;
Â  color: #6e6e73;
Â  margin-bottom: 4px;
}

input {
Â  width: 100%;
Â  height: 38px;
Â  padding: 6px 10px;
Â  font-size: 15px;
Â  border-radius: 10px;
Â  border: 1px solid #d1d1d6;
Â  background: #fafafa;
Â  box-sizing: border-box;
}

.header, .row {
Â  display: flex;
Â  gap: 8px;
Â  align-items: center;
Â  margin-bottom: 8px;
Â  font-size: 14px;
}

.header div { font-weight: 600; }

.no { width: 26px; text-align: center; }
.price-input {
Â  width: 90px;
Â  text-align: center;
Â  font-weight: 600;
}

button {
Â  padding: 8px 10px;
Â  font-size: 14px;
Â  border: none;
Â  border-radius: 10px;
Â  background: #4a6cf7;
Â  color: #fff;
}

button.delete {
Â  background: #e5e5ea;
Â  color: #333;
}

.highlight {
Â  font-size: 16px;
Â  font-weight: 600;
}

Â  /* ===== æ‰‹æ©Ÿç‰ˆæ¬„ä½ä¿®æ­£ ===== */
@media (max-width: 480px) {
Â  /* éš±è—è´ˆå“ header çš„ã€Œå¹³å‡æŠ˜å…¥ã€ */
Â  #gifts .header div:nth-child(4) {
Â  Â  display: none;
Â  }
/* checkbox å®¹å™¨å®šä½ */
Â  #gifts .row input[type="checkbox"] {
Â  Â  position: relative;
Â  Â  margin-top: 14px;
Â  }
Â  Â /* checkbox ä¸Šæ–¹çš„æ–‡å­— */
Â  #gifts .row input[type="checkbox"]::before {
Â  Â  position: absolute;
Â  Â  top: -14px;
Â  Â  left: 50%;
Â  Â  transform: translateX(-50%);
Â  Â  font-size: 11px;
Â  Â  color: #6e6e73;
Â  Â  white-space: nowrap;
Â  }
Â  /* ç¬¬ä¸€è¡Œ */
Â  #gifts .header div:nth-child(1) { grid-row: 1; } /* # */
Â  #gifts .header div:nth-child(2) { grid-row: 1; } /* è´ˆå“åç¨± */

Â  /* ç¬¬äºŒè¡Œ */
Â  #gifts .header div:nth-child(3) {
Â  Â  grid-row: 2;
Â  Â  grid-column: 2;
Â  Â  font-size: 12px;
Â  Â  color: #6e6e73;
Â  }

Â  #gifts .header div:nth-child(4) {
Â  Â  grid-row: 2;
Â  Â  grid-column: 2;
Â  Â  justify-self: end;
Â  Â  font-size: 12px;
Â  Â  color: #6e6e73;
Â  }
Â  .header,
Â  .row {
Â  Â  display: grid;
Â  Â  grid-template-columns: 26px 1fr 70px 64px auto;
Â  Â  gap: 6px;
Â  Â  align-items: center;
Â  }

Â  /* è´ˆå“/åŠ è³¼å“ æ¬„ä½ï¼ˆæ²’æœ‰åœ˜è³¼åƒ¹ï¼Œå¤šä¸€å€‹ checkbox / å›ºå®šåƒ¹ï¼‰ */
Â  #gifts .header,
Â  #gifts .row,
  #addons .header,
  #addons .row {
Â  Â  grid-template-columns: 26px 1fr 70px 64px auto;
Â  }

Â  .price-input {
Â  Â  width: 64px;
Â  Â  padding: 4px;
Â  }

Â  input[type="checkbox"] {
Â  Â  transform: scale(1.2);
Â  }

Â  button.delete {
Â  Â  padding: 6px;
Â  }
}
</style>
</head>

<body>

<h2>ğŸ“¦ Yuna åœ˜è³¼æ¹Šåœ˜è¨ˆç®—å™¨Ver1.0<br>ğŸ’© By ç’ç’ç’</h2>

<div class="section">
Â  <b>å„ªæƒ æŠ˜æ•¸</b>
Â  <div class="grid3">
Â  Â  <div>
Â  Â  Â  <div class="label">å„ªæƒ çµ„åˆé‡‘é¡</div>
Â  Â  Â  <input type="number" id="bundlePrice" oninput="calculate()" />
Â  Â  </div>
Â  Â  <div>
Â  Â  Â  <div class="label">æŠ˜æ‰£ç¢¼é‡‘é¡</div>
Â  Â  Â  <input type="number" id="coupon" oninput="calculate()" />
Â  Â  </div>
Â  Â  <div>
Â  Â  Â  <div class="label">ç¸½åŸåƒ¹é‡‘é¡</div>
Â  Â  Â  <input type="number" id="bundleOriginal" oninput="calculate()" />
Â  Â  </div>
Â  </div>
Â  <div>æŠ˜æ•¸ï¼š<b id="discountRate">0</b></div>
</div>

<div class="section">
Â  <b>åœ˜è³¼å“é … (åƒ¹æ ¼éš¨æŠ˜æ•¸è®Šå‹•)</b>
Â  <div class="header">
Â  Â  <div class="no">#</div>
Â  Â  <div style="flex:1">å“é …åç¨±</div>
Â  Â  <div style="flex:1">åŸåƒ¹</div>
Â  Â  <div>åœ˜è³¼åƒ¹</div>
Â  </div>
Â  <div id="items"></div>
Â  <button onclick="addItem()">â• æ–°å¢å“é …</button>
</div>

<div class="section">
Â  <b>åŠ è³¼å“é … (å›ºå®šé‡‘é¡)</b>
Â  <div class="header">
Â  Â  <div class="no">#</div>
Â  Â  <div style="flex:1">å“é …åç¨±</div>
Â  Â  <div style="flex:1">é‡‘é¡</div>
Â  Â  <div>æ¹Šåœ˜åƒ¹</div>
Â  </div>
Â  <div id="addons"></div>
Â  <button onclick="addAddon()">â• æ–°å¢åŠ è³¼å“</button>
</div>


<div class="section">
Â  <b>è´ˆå“</b>
Â  <div class="header">
Â  Â  <div class="no">#</div>
Â  Â  <div style="flex:1">è´ˆå“åç¨±</div>
Â  Â  <div style="flex:1">é‡‘é¡</div>
Â  Â  <div>å¹³å‡æŠ˜å…¥</div>
Â  </div>
Â  <div id="gifts"></div>
Â  <button onclick="addGift()">â• æ–°å¢è´ˆå“</button>
</div>

<div class="section">
Â  <div class="highlight">ä¸»è³¼å¯¦éš›çµå¸³é‡‘é¡ï¼š<span id="checkout">0</span></div>
Â  <div class="highlight">æ¹Šåœ˜ç¸½åƒ¹ï¼š<span id="groupTotal">0</span> <span id="checkMark"></span></div>
Â  <br>
Â  <button onclick="copyText()">ğŸ“‹ ä¸€éµè¤‡è£½èªè³¼æ¸…å–®</button>
</div>

<script>
let groupSumWithoutGifts = 0;
function getRate() {
Â  const original = Number(bundleOriginal.value) || 0;
Â  const actualPrice = (Number(bundlePrice.value) || 0) - (Number(coupon.value) || 0);
Â  return original > 0
Â  Â  ? actualPrice / original
Â  Â  : 0;
}

function renumber() {
Â  let i = 1;
Â  // åœ˜è³¼å“é …
Â  document.querySelectorAll("#items .row").forEach(r => r.querySelector(".no").innerText = i++);
Â  // åŠ è³¼å“é …
Â  document.querySelectorAll("#addons .row").forEach(r => r.querySelector(".no").innerText = i++);
Â  // è´ˆå“
Â  document.querySelectorAll("#gifts .row").forEach(r => r.querySelector(".no").innerText = i++);
}

function addItem() {
Â  const r = document.createElement("div");
Â  r.className = "row";
Â  r.innerHTML = `
Â  Â  <div class="no"></div>
Â  Â  <input placeholder="å“é …åç¨±" />
Â  Â  <input type="number" placeholder="åŸåƒ¹" oninput="calculate()" />
Â  Â  <input type="number" class="price-input" value="0" min="0"
Â  Â  Â  oninput="this.dataset.locked='1'; calculate()" />
Â  Â  <button class="delete" onclick="this.parentElement.remove(); calculate()">âœ–</button>
Â  `;
Â  items.appendChild(r);
Â  renumber();
Â  calculate();
}

// ğŸ“Œ æ–°å¢åŠ è³¼å“å‡½å¼
function addAddon() {
Â  const r = document.createElement("div");
Â  r.className = "row";
Â  r.innerHTML = `
Â  Â  <div class="no"></div>
Â  Â  <input placeholder="å“é …åç¨±" />
Â  Â  <input type="number" placeholder="é‡‘é¡" value="0" oninput="calculate()" />
Â  Â  <input type="number" class="price-input" value="0" readonly style="border:none; background:none; font-weight:600;" />
Â  Â  <button class="delete" onclick="this.parentElement.remove(); calculate()">âœ–</button>
Â  `;
Â  addons.appendChild(r);
Â  renumber();
Â  calculate();
}

function addGift() {
Â  const r = document.createElement("div");
Â  r.className = "row";
Â  r.innerHTML = `
Â  Â  <div class="no"></div>
Â  Â  <input placeholder="è´ˆå“åç¨±" />
Â  Â  <input type="number" placeholder="é‡‘é¡" oninput="calculate()" />
Â  Â  <input type="checkbox" onchange="calculate(true)" />
Â  Â  <button class="delete" onclick="this.parentElement.remove(); calculate(true)">âœ–</button>
Â  `;
Â  gifts.appendChild(r);
Â  renumber();
Â  calculate(); // ç¢ºä¿æ–°å¢å¾Œæœƒæ›´æ–°è¨ˆç®—
}

function calculate(forceRecalc = false) {
Â  const rate = getRate();
Â  discountRate.innerText = rate.toFixed(4);

Â  const itemRows = document.querySelectorAll("#items .row");
Â  const giftRows = document.querySelectorAll("#gifts .row");
Â  const addonRows = document.querySelectorAll("#addons .row"); // å–å¾—åŠ è³¼å“

Â  let giftSharedTotal = 0;
Â  giftRows.forEach(r => {
Â  Â  const amount = Number(r.children[2].value) || 0;
Â  Â  const shared = r.children[3].checked;
Â  Â  if (shared) giftSharedTotal -= amount;
Â  });

Â  const sharePerItem = itemRows.length
Â  Â  ? Math.round(giftSharedTotal / itemRows.length)
Â  Â  : 0;

Â  let groupSum = 0;
Â  let addonTotal = 0; // åŠ è³¼å“ç¸½é‡‘é¡

Â  // 1. è¨ˆç®—åœ˜è³¼å“é … (å—æŠ˜æ•¸åŠè´ˆå“åˆ†æ”¤å½±éŸ¿)
Â  itemRows.forEach(r => {
Â  Â  const original = Number(r.children[2].value) || 0;
Â  Â  const basePrice = Math.round(original * rate);
Â  Â  const priceEl = r.querySelector(".price-input");

Â  Â  if (forceRecalc || !priceEl.dataset.locked) {
Â  Â  Â  priceEl.value = basePrice + sharePerItem;
Â  Â  }
Â  Â  groupSum += Number(priceEl.value);
Â  });

Â  // 2. è¨ˆç®—åŠ è³¼å“é … (å›ºå®šé‡‘é¡ï¼Œä¸è®Šå‹•)
Â  addonRows.forEach(r => {
Â  Â  const amount = Number(r.children[2].value) || 0;
Â  Â  r.querySelector(".price-input").value = amount; // è¨­å®šæ¹Šåœ˜åƒ¹ = é‡‘é¡
Â  Â  addonTotal += amount;
Â  });
Â  
Â  // 3. è¨ˆç®—ç¸½è¨ˆ
Â  
Â  // ä¸»è³¼å¯¦éš›çµå¸³é‡‘é¡ï¼šå„ªæƒ çµ„åˆé‡‘é¡ - æŠ˜æ‰£ç¢¼
Â  const checkoutVal = (Number(bundlePrice.value) || 0) - (Number(coupon.value) || 0);
Â  
Â  // æ¹Šåœ˜ç¸½åƒ¹ï¼šæ‰€æœ‰æ¹Šåœ˜é‡‘é¡ (å“é … + åŠ è³¼å“) + å‹¾é¸å¹³å‡æŠ˜å…¥çš„è´ˆå“é‡‘é¡ (æŠµéŠ·/åŠ å›)
Â  const sharedGiftAmount = Math.abs(giftSharedTotal);
Â  const displayGroupTotal = groupSum + sharedGiftAmount + addonTotal;
Â  
Â  checkout.innerText = checkoutVal;
Â  groupTotal.innerText = displayGroupTotal ;
Â  checkMark.innerText = checkoutVal === displayGroupTotal ? "âœ…" : "âŒ";
Â Â 
Â  // è¤‡è£½æ¸…å–®ç”¨çš„ç¸½åƒ¹ (ä¸å«è´ˆå“ï¼Œæ‡‰ç­‰æ–¼ checkoutVal)
Â  groupSumWithoutGifts = groupSum - giftSharedTotal + addonTotal;

Â  renumber();
}

addItem();

function copyText() {
Â 
Â  calculate(); // ç¢ºä¿æ‰€æœ‰æ•¸å€¼æ˜¯æœ€æ–°çš„
Â  let text = `ğŸ“¦ æ¹Šåœ˜èªè³¼æ¸…å–®

`;

Â  text += `å„ªæƒ çµ„åˆé‡‘é¡ğŸ’°${bundlePrice.value || 0}
`;
Â  text += `æŠ˜æ‰£ç¢¼ğŸ’°${coupon.value || 0}
`;
Â  text += `æŠ˜æ•¸ï¼š${discountRate.innerText}

`;

Â  let i = 1;

Â  // è¤‡è£½åœ˜è³¼å“é …
Â  document.querySelectorAll("#items .row").forEach(r => {
Â  Â  const name = r.children[1].value || "ï¼ˆæœªå¡«å¯«ï¼‰";
Â  Â  const price = r.querySelector(".price-input").value;
Â  Â  text += `${i++}. ${name} $${price} â¡ï¸
`;
Â  });

Â  // ğŸ“Œ è¤‡è£½åŠ è³¼å“é …
Â  document.querySelectorAll("#addons .row").forEach(r => {
Â  Â  const name = r.children[1].value || "ï¼ˆæœªå¡«å¯«ï¼‰";
Â  Â  const price = r.children[2].value; // ç›´æ¥å–é‡‘é¡æ¬„ä½
Â  Â  text += `${i++}. åŠ è³¼ï¼š${name} $${price} â¡ï¸
`;
Â  });

Â  // è¤‡è£½è´ˆå“
Â  document.querySelectorAll("#gifts .row").forEach(r => {
Â  Â  const name = r.children[1].value || "ï¼ˆæœªå¡«å¯«ï¼‰";
Â  Â  const amount = r.children[2].value || 0;
Â  Â  const shared = r.children[3].checked;
Â  Â  text += `${i++}. è´ˆå“ï¼š${name} $${amount}${shared ? "ï¼ˆå¹³å‡æŠ˜å…¥ï¼‰" : ""} â¡ï¸
`;
Â  });

Â  text += `
ä¸»è³¼å¯¦éš›çµå¸³é‡‘é¡ğŸ’°${checkout.innerText}
`;
Â  // é¡¯ç¤ºæ¹Šåœ˜ç¸½åƒ¹ (ä¸åŒ…å«ã€Œå¹³å‡æŠ˜å…¥ã€çš„è´ˆå“é‡‘é¡)
Â  text += `æ¹Šåœ˜ç¸½åƒ¹ğŸ’°${groupSumWithoutGifts}${Number(checkout.innerText) === groupSumWithoutGifts ? "âœ…" : ""}
`;
Â  text += `â­ï¸è«‹åœ¨ç®­é ­â¡ï¸å¾Œæ–¹æ‰“ä¸Šåå­—èªè³¼`;

Â  navigator.clipboard.writeText(text);
Â  alert("å·²è¤‡è£½ï¼Œå¯ç›´æ¥è²¼åˆ°ç¤¾ç¾¤ï¼");
}

</script>

</body>
</html>
